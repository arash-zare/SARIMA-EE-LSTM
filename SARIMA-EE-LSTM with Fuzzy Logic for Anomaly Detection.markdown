# SARIMA-EE-LSTM با منطق فازی برای تشخیص ناهنجاری در داده‌های زمانی: مقایسه با ARIMA-EE-LSTM

## چکیده
تشخیص ناهنجاری در داده‌های زمانی، به‌ویژه در شبکه‌های ارتباطی، برای شناسایی تهدیدات سایبری مانند حملات DDoS و بهبود امنیت شبکه حیاتی است. این مقاله به معرفی یک سیستم پیشرفته به نام SARIMA-EE-LSTM می‌پردازد که ترکیبی از مدل‌های SARIMA (Seasonal Autoregressive Integrated Moving Average)، EELSTM (Ensemble Encoder Long Short-Term Memory) و منطق فازی برای پیش‌بینی و تشخیص ناهنجاری در داده‌های زمانی شبکه است. این سیستم برای کاربردهای امنیتی در نیروی انتظامی طراحی شده و از داده‌های واقعی VictoriaMetrics برای مانیتورینگ متریک‌های شبکه استفاده می‌کند. ما این روش را با رویکرد اصلی ARIMA-EE-LSTM مقایسه می‌کنیم و نشان می‌دهیم که SARIMA به دلیل مدل‌سازی الگوهای فصلی و منطق فازی برای تشخیص ناهنجاری دقیق‌تر و قابل‌تفسیرتر است. نتایج ارزیابی نشان‌دهنده توانایی سیستم در شناسایی ناهنجاری‌ها است، اگرچه نیاز به تنظیم آستانه‌ها و آموزش با داده‌های واقعی وجود دارد.

## 1. مقدمه
تشخیص ناهنجاری در داده‌های زمانی یکی از چالش‌های کلیدی در حوزه امنیت سایبری و مانیتورینگ شبکه است. ناهنجاری‌ها می‌توانند نشان‌دهنده حملات سایبری، خرابی‌های سیستمی یا تغییرات غیرمنتظره در رفتار شبکه باشند. در زمینه نیروی انتظامی، شناسایی سریع این ناهنجاری‌ها برای جلوگیری از تهدیدات امنیتی و حفظ پایداری شبکه‌های ارتباطی ضروری است.

پروژه SARIMA-EE-LSTM یک سیستم پیشرفته برای پیش‌بینی و تشخیص ناهنجاری در داده‌های زمانی شبکه است که از ترکیب مدل‌های SARIMA، EELSTM و منطق فازی بهره می‌برد. SARIMA برای مدل‌سازی الگوهای فصلی هر ویژگی به‌صورت جداگانه استفاده می‌شود، در حالی که EELSTM پیش‌بینی‌های کلی را با یادگیری الگوهای پیچیده ارائه می‌دهد. منطق فازی با محاسبه امتیازهای ریسک فازی، تشخیص ناهنجاری را بهبود می‌بخشد. این مقاله جزئیات این سیستم، عملکرد آن و مقایسه با روش ARIMA-EE-LSTM را ارائه می‌دهد.

## 2. پیش‌زمینه
داده‌های زمانی شامل مشاهدات متوالی در فواصل زمانی منظم هستند که در حوزه‌های مختلفی مانند شبکه‌های ارتباطی، مالی و صنعتی کاربرد دارند. تشخیص ناهنجاری در این داده‌ها شامل شناسایی نقاط یا الگوهایی است که از رفتار عادی منحرف می‌شوند. چالش‌های اصلی شامل مدیریت فصلی بودن، غیرایستا بودن و ابعاد بالای داده‌ها است.

روش‌های سنتی مانند ARIMA و SARIMA برای پیش‌بینی داده‌های زمانی استفاده می‌شوند، اما برای الگوهای پیچیده و وابستگی‌های طولانی‌مدت ممکن است کافی نباشند. شبکه‌های عصبی LSTM به دلیل توانایی در حفظ وابستگی‌های طولانی‌مدت، برای پیش‌بینی داده‌های زمانی مناسب هستند. منطق فازی نیز با ارائه رویکردی انعطاف‌پذیر برای تصمیم‌گیری در شرایط نامشخص، در تشخیص ناهنجاری مؤثر است.

## 3. مدل SARIMA
SARIMA یک مدل آماری برای پیش‌بینی داده‌های زمانی با الگوهای فصلی است. فرمول کلی آن به صورت زیر است:
\[
\text{SARIMA}(p, d, q)(P, D, Q)_m
\]
- \(p, d, q\): پارامترهای غیرفصلی برای خودکار، تفاضل و متحرک متوسط.
- \(P, D, Q\): پارامترهای فصلی.
- \(m\): دوره فصلی (مثلاً 60 برای داده‌های ثانیه‌ای در یک دقیقه).

در پروژه SARIMA-EE-LSTM، برای هر ویژگی (مانند `network_receive_rate`) یک مدل SARIMA آموزش داده می‌شود تا الگوهای فصلی خاص آن ویژگی را مدل‌سازی کند. این رویکرد به سیستم اجازه می‌دهد تا پیش‌بینی‌های دقیق‌تری برای هر ویژگی ارائه دهد.

## 4. مدل EELSTM
EELSTM (Ensemble Encoder Long Short-Term Memory) یک شبکه عصبی متکرر است که از چندین لایه LSTM برای پیش‌بینی داده‌های زمانی استفاده می‌کند. معماری آن شامل:
- **لایه‌های LSTM**: برای یادگیری الگوهای طولانی‌مدت و غیرخطی.
- **لایه کاملاً متصل (Fully Connected)**: برای تولید پیش‌بینی‌های نهایی.

EELSTM به عنوان یک مدل انسمبل عمل می‌کند که تمام ویژگی‌ها را به‌صورت همزمان پردازش می‌کند و پیش‌بینی‌های کلی ارائه می‌دهد. این مدل در پروژه برای تکمیل پیش‌بینی‌های SARIMA استفاده می‌شود.

## 5. منطق فازی برای تشخیص ناهنجاری
منطق فازی با استفاده از توابع عضویت، امکان تصمیم‌گیری در شرایط نامشخص را فراهم می‌کند. در این پروژه، منطق فازی برای محاسبه امتیاز ریسک فازی (بین 0 و 1) بر اساس خطای پیش‌بینی (MSE) استفاده می‌شود. اگر MSE از آستانه خاصی بیشتر باشد، ویژگی به عنوان ناهنجاری شناسایی می‌شود. این روش نسبت به آستانه‌های سخت سنتی انعطاف‌پذیرتر است و امکان تشخیص ناهنجاری‌های جزئی را فراهم می‌کند.

## 6. معماری پروژه SARIMA-EE-LSTM
پروژه SARIMA-EE-LSTM شامل مراحل زیر است:
1. **دریافت داده‌ها**: داده‌های زمانی از VictoriaMetrics با استفاده از `data_fetcher.py` دریافت می‌شوند. این داده‌ها شامل متریک‌های شبکه مانند نرخ دریافت و ارسال شبکه، تعداد اتصالات فعال و غیره هستند.
2. **پیش‌پردازش**: داده‌ها با استفاده از `MinMaxScaler` در `preprocessing.py` نرمال‌سازی می‌شوند.
3. **پیش‌بینی**:
   - مدل‌های SARIMA برای هر ویژگی جداگانه آموزش داده می‌شوند.
   - مدل EELSTM برای پیش‌بینی کلی تمام ویژگی‌ها استفاده می‌شود.
4. **تشخیص ناهنجاری**: خطای پیش‌بینی (MSE) محاسبه شده و با استفاده از منطق فازی در `fuzzy.py` به امتیاز ریسک تبدیل می‌شود.
5. **رسم نمودار**: نمودارهای پیش‌بینی و ناهنجاری با استفاده از `matplotlib_utils.py` تولید و در `./saved_plots` ذخیره می‌شوند.

### جدول اجزای پروژه
| **جزء**              | **توضیحات**                                                                 | **فایل مرتبط**            |
|----------------------|-----------------------------------------------------------------------------|---------------------------|
| دریافت داده‌ها       | دریافت داده‌های زمانی از VictoriaMetrics                                   | `data_fetcher.py`         |
| پیش‌پردازش          | نرمال‌سازی داده‌ها با MinMaxScaler                                        | `preprocessing.py`        |
| مدل SARIMA          | پیش‌بینی فصلی برای هر ویژگی                                              | `model.py`                |
| مدل EELSTM          | پیش‌بینی کلی با استفاده از LSTM انسمبل                                  | `model.py`                |
| تشخیص ناهنجاری      | محاسبه MSE و امتیاز ریسک فازی                                            | `detect_anomalies.py`, `fuzzy.py` |
| رسم نمودار          | تولید نمودارهای پیش‌بینی و ناهنجاری                                     | `matplotlib_utils.py`     |

## 7. مقایسه SARIMA-EE-LSTM با ARIMA-EE-LSTM
### ARIMA-EE-LSTM
- **مدل ARIMA**: برای پیش‌بینی داده‌های غیرفصلی استفاده می‌شود. فرمول آن:
  \[
  \text{ARIMA}(p, d, q)
  \]
  - محدودیت: عدم توانایی در مدل‌سازی الگوهای فصلی.
- **تشخیص ناهنجاری**: معمولاً با آستانه‌های سخت (مانند MSE بیشتر از یک مقدار خاص) انجام می‌شود.
- **کاربرد**: مناسب برای داده‌های بدون الگوهای فصلی، اما برای متریک‌های شبکه با الگوهای روزانه یا هفتگی کمتر مؤثر است.

### SARIMA-EE-LSTM با منطق فازی
- **مدل SARIMA**: با اضافه کردن پارامترهای فصلی، الگوهای تکراری را مدل‌سازی می‌کند.
- **منطق فازی**: تشخیص ناهنجاری را با امتیازهای ریسک فازی بهبود می‌بخشد، که انعطاف‌پذیرتر و قابل‌تفسیرتر است.
- **کاربرد**: برای داده‌های شبکه با الگوهای فصلی پیچیده مناسب‌تر است.

### جدول مقایسه
| **ویژگی**                | **ARIMA-EE-LSTM**                              | **SARIMA-EE-LSTM با منطق فازی**                     |
|---------------------------|-----------------------------------------------|----------------------------------------------------|
| مدل پیش‌بینی             | ARIMA (غیرفصلی)                              | SARIMA (فصلی)                                     |
| تشخیص ناهنجاری           | آستانه‌های سخت                              | منطق فازی با امتیازهای ریسک                     |
| دقت پیش‌بینی             | کمتر برای داده‌های فصلی                      | بالاتر به دلیل مدل‌سازی فصلی                     |
| انعطاف‌پذیری تشخیص      | محدود به آستانه‌های ثابت                    | انعطاف‌پذیر با آستانه‌های نرم                  |
| کاربرد                    | داده‌های غیرفصلی                            | داده‌های فصلی مانند متریک‌های شبکه              |

## 8. ارزیابی عملکرد
### داده‌های استفاده‌شده
داده‌ها از VictoriaMetrics دریافت شده‌اند و شامل 8 ویژگی شبکه (مانند `network_receive_rate`, `active_connections`) با 1081 نمونه زمانی هستند. این داده‌ها با تنظیمات `start_offset="10m"`, `duration="8m"`, و `step="1s"` جمع‌آوری شده‌اند.

### معیارهای ارزیابی
- **MSE (Mean Squared Error)**: برای سنجش دقت پیش‌بینی.
- **امتیاز ریسک فازی**: برای ارزیابی شدت ناهنجاری‌ها (0 تا 1).
- **نمودارهای بصری**: برای تأیید ناهنجاری‌ها و پیش‌بینی‌ها.

### نتایج
- **دریافت داده‌ها**: داده‌ها با شکل `(1081, 8)` دریافت شدند، که نشان‌دهنده موفقیت در دریافت داده‌های واقعی است.
- **پیش‌بینی‌ها**:
  - مقادیر پیش‌بینی‌شده برای اکثر ویژگی‌ها (مانند `26550334.76` برای `network_receive_rate`) در محدوده‌های معقول هستند.
  - مقادیر واقعی برای برخی ویژگی‌ها (مانند `445944803586228.94`) غیرواقعی به نظر می‌رسند، که ممکن است به دلیل خطای سرور یا حمله باشد.
- **تشخیص ناهنجاری**:
  - تمام ویژگی‌ها به‌عنوان ناهنجاری شناسایی شدند، که غیرمعمول است و نشان‌دهنده آستانه‌های نامناسب یا داده‌های غیرعادی است.
  - امتیازهای ریسک فازی (0.50 تا 0.82) منطقی هستند، اما ورودی‌های فازی مانند `residual=-1000.00` غیرمنطقی‌اند.
- **نمودارها**: نمودارهای پیش‌بینی و ناهنجاری برای اکثر ویژگی‌ها ذخیره شدند، اما نیاز به مقیاس لگاریتمی برای خوانایی بهتر است.

### مشکلات شناسایی‌شده
- **MSE‌های بزرگ**: به دلیل اختلافات مقیاس بین مقادیر واقعی و پیش‌بینی‌شده.
- **ورودی‌های فازی غیرمنطقی**: مانند `residual=-1000.00`.
- **تشخیص ناهنجاری برای همه ویژگی‌ها**: به دلیل آستانه‌های نامناسب.
- **پیش‌بینی منفی**: مانند `-0.05` برای `receive_errors_rate`.

## 9. نتیجه‌گیری و کارهای آینده
SARIMA-EE-LSTM با منطق فازی یک سیستم قدرتمند برای تشخیص ناهنجاری در داده‌های زمانی شبکه است که با ترکیب SARIMA، EELSTM و منطق فازی، دقت و انعطاف‌پذیری بالایی ارائه می‌دهد. مقایسه با ARIMA-EE-LSTM نشان می‌دهد که SARIMA به دلیل مدل‌سازی الگوهای فصلی و منطق فازی برای تشخیص ناهنجاری مناسب‌تر است. با این حال، مشکلات مقیاس‌بندی و آستانه‌های نامناسب نیاز به توجه دارند.

**کارهای آینده**:
- آموزش مجدد مدل با داده‌های واقعی.
- تنظیم آستانه‌های `THRESHOLDS` و `FUZZY_THRESHOLDS` بر اساس داده‌های واقعی.
- بهبود منطق فازی برای محاسبه دقیق‌تر `residual`.
- افزودن هشدارهای بلادرنگ و داشبورد وب برای مانیتورینگ.

## منابع
- [Detection and quantification of anomalies in communication networks based on LSTM-ARIMA combined model](https://link.springer.com/article/10.1007/s13042-022-01586-8)
- [Anomaly Detection in Time Series](https://neptune.ai/blog/anomaly-detection-in-time-series)
- [Data Normalization and Anomaly Detection in a Steel Plate-Girder Bridge Using LSTM](https://ascelibrary.org/doi/10.1061/AJRUA6.0001203)
- [Time Series Forecasting with ARIMA, SARIMA and SARIMAX](https://towardsdatascience.com/time-series-forecasting-with-arima-sarima-and-sarimax-ee61099e78f6)
- [SARIMA vs LSTM. Time series forecasting using…](https://medium.com/@ishanmazumderedu/sarima-vs-lstm-9c90545c2157)